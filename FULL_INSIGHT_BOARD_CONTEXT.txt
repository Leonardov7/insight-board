=== ESTRUCTURA DEL PROYECTO ===
.\CHANGELOG.md
.\eslint.config.js
.\package.json
.\postcss.config.js
.\README.md
.\src\App.css
.\src\App.jsx
.\src\components\AccessGuard.jsx
.\src\components\AdminTools.jsx
.\src\components\AnalyticsModal.jsx
.\src\components\Board.jsx
.\src\components\InputArea.jsx
.\src\components\Leaderboard.jsx
.\src\components\Login.jsx
.\src\components\MessageCard.jsx
.\src\components\ParticipantsList.jsx
.\src\components\ReactionBar.jsx
.\src\components\SessionManager.jsx
.\src\components\Sidebar.jsx
.\src\components\SynapseNode.jsx
.\src\components\TopStatusHub.jsx
.\src\hooks\useMessages.js
.\src\hooks\usePresence.js
.\src\hooks\useReactions.js
.\src\hooks\useSessions.js
.\src\index.css
.\src\lib\supabase.js
.\src\main.jsx
.\src\services\aiService.js
.\src\utils\aliases.js
.\src\utils\layout.js
.\tailwind.config.js
.\vite.config.js


=== CONTENIDO DE ARCHIVOS ===

================================================================================
ARCHIVO: .\CHANGELOG.md
================================================================================
# Cognity Board - Registro de Versiones

## [1.2.0] - Desarrollo: Agente Provocador
**Estado: En proceso (Rama actual)**

### Objetivos t√©cnicos
- Implementaci√≥n del **Agente Provocador** (Abogado del Diablo).
- Configuraci√≥n de l√≥gica socr√°tica para desafiar consensos autom√°ticos.
- Interfaz visual diferenciada para las intervenciones de la IA.

---

## [1.1.0] - Planeado: Inteligencia Anal√≠tica y Gamificaci√≥n
**Estado: Pendiente**

### Anal√≠tica Sem√°ntica
- Clustering tem√°tico mediante embeddings.
- Detecci√≥n de posturas: Sinton√≠a, Disonancia y Divergencia.

### Gamificaci√≥n Cognitiva
- Sistema de "Energ√≠a de Sinapsis".
- Evoluci√≥n visual de nodos por resonancia.

---

## [1.0.0] - Estable: Motor de Sinapsis
**Estado: Lanzamiento inicial**

================================================================================
ARCHIVO: .\eslint.config.js
================================================================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


================================================================================
ARCHIVO: .\package.json
================================================================================
{
  "name": "insight-board",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.39.7",
    "clsx": "^2.1.0",
    "dagre": "^0.8.5",
    "framer-motion": "^12.33.0",
    "jspdf": "^4.1.0",
    "jspdf-autotable": "^5.0.7",
    "lucide-react": "^0.344.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "reactflow": "^11.11.4",
    "tailwind-merge": "^2.2.1"
  },
  "devDependencies": {
    "@types/react": "^18.2.66",
    "@types/react-dom": "^18.2.22",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.18",
    "postcss": "^8.4.35",
    "tailwindcss": "^3.4.1",
    "vite": "^5.1.6"
  }
}


================================================================================
ARCHIVO: .\postcss.config.js
================================================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

================================================================================
ARCHIVO: .\README.md
================================================================================
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.


================================================================================
ARCHIVO: .\src\App.css
================================================================================
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}


================================================================================
ARCHIVO: .\src\App.jsx
================================================================================
import React, { useEffect, useState } from 'react';
import { useMessages } from './hooks/useMessages';
import { usePresence } from './hooks/usePresence';
import AccessGuard from './components/AccessGuard';
import Board from './components/Board';
import InputArea from './components/InputArea';
import Sidebar from './components/Sidebar';
import AnalyticsModal from './components/AnalyticsModal';
import TopStatusHub from './components/TopStatusHub';
import { Settings, Hash, Activity, Rocket, Zap, Database, LogOut } from 'lucide-react';
import { supabase } from './lib/supabase';
import { getEngagementRanking } from './services/aiService';

// --- NUEVO COMPONENTE: LOGIN ---
const LoginView = () => (
  <div className="h-screen w-screen bg-[#060608] flex items-center justify-center p-6">
    <div className="max-w-md w-full bg-[#0e0e12] border border-white/10 rounded-[3rem] p-12 text-center shadow-2xl relative overflow-hidden">
      <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 to-purple-500" />
      <h2 className="text-2xl font-black text-white uppercase italic tracking-tighter mb-2">Bienvenido</h2>
      <p className="text-slate-500 text-[10px] font-bold uppercase tracking-[0.2em] mb-10">Gestiona tu Red Sin√°ptica Profesional</p>
      
      <button 
        onClick={() => supabase.auth.signInWithOAuth({ provider: 'google' })}
        className="w-full py-4 bg-white text-black rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-slate-200 transition-all flex items-center justify-center gap-3 shadow-lg"
      >
        <img src="https://www.google.com/favicon.ico" className="w-4 h-4" alt="Google" />
        Entrar con Google
      </button>
    </div>
  </div>
);

function App() {
  const queryParams = new URLSearchParams(window.location.search);
  
  // --- NUEVOS ESTADOS DE IDENTIDAD ---
  const [sessionAuth, setSessionAuth] = useState(null);
  const [appView, setAppView] = useState('launcher'); // 'launcher' | 'insight-board'
  
  // Mantenemos el soporte para el par√°metro admin o lo vinculamos al login
  const isAdmin = queryParams.get('admin') === 'true' || !!sessionAuth;

  const [session, setSession] = useState(null);
  const [user, setUser] = useState(null);
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);
  const [isAnalyticsOpen, setIsAnalyticsOpen] = useState(false);
  const [ranking, setRanking] = useState([]);
  const [replyingTo, setReplyingTo] = useState(null);

  const { messages, sendMessage, fetchMessagesBySession, subscribeToMessages } = useMessages();
  const onlineUsers = usePresence(session?.id, user);

  // --- ESCUCHA DE AUTENTICACI√ìN ---
  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session: s } }) => setSessionAuth(s));
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, s) => setSessionAuth(s));
    return () => subscription.unsubscribe();
  }, []);

  // --- ANTENA DE SINCRONIZACI√ìN ---
  useEffect(() => {
    if (!session?.id) return;

    fetchMessagesBySession(session.id);
    const unsubscribeMessages = subscribeToMessages(session.id);

    const channelName = `sync_gate_${session.id}`;
    const channel = supabase.channel(channelName, {
      config: { broadcast: { self: true } }
    })
      .on('broadcast', { event: 'START_SESSION' }, () => {
        setSession(prev => ({ ...prev, status: 'active' }));
      })
      .on('postgres_changes',
        { event: 'UPDATE', schema: 'public', table: 'sesiones', filter: `id=eq.${session.id}` },
        (payload) => {
          if (payload.new.status === 'active') {
            setSession(prev => ({ ...prev, status: 'active' }));
          }
        }
      )
      .subscribe();

    const poller = setInterval(async () => {
      if (!isAdmin && session?.status !== 'active') {
        const { data } = await supabase.from('sesiones').select('status').eq('id', session.id).maybeSingle();
        if (data?.status === 'active') {
          setSession(prev => ({ ...prev, status: 'active' }));
          clearInterval(poller);
        }
      }
    }, 3000);

    return () => {
      if (unsubscribeMessages) unsubscribeMessages();
      supabase.removeChannel(channel);
      clearInterval(poller);
    };
  }, [session?.id]);

  // --- PULSO DE GAMIFICACI√ìN ---
  useEffect(() => {
    if (messages.length >= 7) {
      const runPulse = async () => {
        try {
          const newRanking = await getEngagementRanking(messages);
          setRanking(newRanking);
        } catch (error) {
          console.error("‚ùå [GAMIFICACI√ìN] Fallo:", error);
        }
      };
      runPulse();
    }
  }, [messages.length]);

  const handleStartSinapsis = async () => {
    if (!session?.id) return;
    await supabase.from('sesiones').update({ status: 'active' }).eq('id', session.id);
    const channel = supabase.channel(`sync_gate_${session.id}`);
    await channel.send({ type: 'broadcast', event: 'START_SESSION', payload: { status: 'active' } });
    setSession(prev => ({ ...prev, status: 'active' }));
  };

  const handleSend = async (text) => {
    if (!session || !user) return;
    const seed = messages.find(m => !m.parent_id);
    const parentId = replyingTo?.msg?.id || (seed ? seed.id : null);
    await sendMessage(text, user.name, user.color, parentId, session.id);
    setReplyingTo(null);
  };

  const handleSwitchSession = (newSession) => {
    setSession(newSession);
    setIsSidebarOpen(false);
  };

  const handleNewDebate = () => {
    setSession(null);
    setUser(null);
    setIsSidebarOpen(false);
  };

  // --- L√ìGICA DE NAVEGACI√ìN ---
  if (!sessionAuth && isAdmin) return <LoginView />;

  if (appView === 'launcher' && isAdmin) {
    return (
      <div className="h-screen w-screen bg-[#060608] flex flex-col items-center justify-center p-10 font-sans">
        <div className="text-center mb-16">
          <h2 className="text-white font-black uppercase tracking-[0.4em] text-[10px] mb-2 opacity-40">Ecosistema Cognitivo</h2>
          <h1 className="text-3xl font-black text-white uppercase italic tracking-tighter">Mis Aplicaciones</h1>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl">
          <button 
            onClick={() => setAppView('insight-board')}
            className="p-12 bg-indigo-600/5 border border-indigo-500/20 rounded-[3rem] hover:bg-indigo-600/10 hover:border-indigo-500/50 transition-all group relative overflow-hidden"
          >
            <div className="absolute top-0 left-0 w-full h-1 bg-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity" />
            <Zap className="text-indigo-400 mb-6 group-hover:scale-110 transition-transform" size={48} />
            <h3 className="text-xl font-black text-white uppercase italic tracking-tighter">Insight Board</h3>
            <p className="text-[10px] text-slate-500 uppercase font-bold mt-3 tracking-widest">Red de Sinapsis en Vivo</p>
          </button>
          
          <div className="p-12 bg-white/[0.02] border border-white/5 rounded-[3rem] opacity-30 grayscale cursor-not-allowed">
            <Database className="text-slate-500 mb-6" size={48} />
            <h3 className="text-slate-500 font-black uppercase italic tracking-tighter text-xl">Dendron LMS</h3>
            <p className="text-[10px] text-slate-600 uppercase font-bold mt-3 tracking-widest">Pr√≥xima Integraci√≥n</p>
          </div>
        </div>

        <button 
          onClick={() => supabase.auth.signOut()}
          className="mt-20 flex items-center gap-2 text-slate-600 hover:text-rose-500 transition-colors text-[10px] font-black uppercase tracking-widest"
        >
          <LogOut size={14} /> Cerrar Sesi√≥n
        </button>
      </div>
    );
  }

  const hasSeed = messages.length > 0;
  const canPost = isAdmin || hasSeed;

  return (
    <AccessGuard
      isAdmin={isAdmin} session={session} user={user}
      setSession={setSession} onUserAssigned={setUser}
      sessionReady={!!session && !!user}
    >
      <div className="h-screen w-screen bg-[#0a0a0c] text-slate-100 flex flex-col overflow-hidden font-sans">
        
        {/* HEADER PRINCIPAL */}
        <header className={`h-16 border-b flex justify-between items-center px-8 z-50 backdrop-blur-xl ${isAdmin ? 'bg-indigo-950/20 border-indigo-500/30' : 'bg-[#0e0e12]/80 border-white/5'}`}>
          <div className="flex items-center gap-8">
            <button onClick={() => setAppView('launcher')} className="flex flex-col hover:opacity-70 transition-opacity">
              <span className="text-[8px] font-black text-indigo-400 uppercase tracking-[0.3em] mb-0.5">Red de Sinapsis</span>
              <h1 className="text-xs font-bold uppercase truncate max-w-[200px] tracking-tight">{session?.tema}</h1>
            </button>
            
            <div className="bg-indigo-600/10 border border-indigo-500/20 px-4 py-1.5 rounded-xl flex items-center gap-3">
              <Hash size={14} className="text-indigo-400" />
              <span className="text-sm font-black text-white font-mono tracking-tighter">{session?.codigo}</span>
            </div>

            {isAdmin && (session?.status === 'waiting' || session?.status === 'inactive') && (
              <button
                onClick={handleStartSinapsis}
                className="px-4 py-1.5 bg-emerald-500 text-[#0a0a0c] text-[10px] font-black uppercase rounded-lg hover:bg-emerald-400 transition-all flex items-center gap-2 animate-pulse shadow-[0_0_15px_rgba(16,185,129,0.4)]"
              >
                <Rocket size={12} />
                {session?.status === 'inactive' ? 'Reactivar Sinapsis' : 'Iniciar Sinapsis'}
              </button>
            )}
          </div>

          <div className="flex items-center gap-6">
            <div className="flex items-center gap-3 px-4 py-2 bg-white/5 border border-white/10 rounded-2xl">
              <div className="w-2.5 h-2.5 rounded-full" style={{ backgroundColor: user?.color }} />
              <span className="text-[10px] font-black text-white uppercase font-mono">{user?.name}</span>
            </div>
            <button onClick={() => setIsSidebarOpen(true)} className="p-2.5 bg-white/5 text-slate-400 rounded-xl hover:bg-white/10 transition-all">
              <Settings size={20} />
            </button>
          </div>
        </header>

        {/* CONTENEDOR CENTRAL */}
        <div className="flex-1 relative flex flex-col overflow-hidden">
          
          {session && (
            <TopStatusHub 
              connectedUsers={onlineUsers} 
              ranking={ranking} 
              sessionStatus={session.status} 
            />
          )}

          <main className="flex-1 relative bg-[#070709] z-10">
            <Board 
              messages={messages} 
              isAdmin={isAdmin} 
              userAlias={user?.name} 
              onReply={(msg, text) => setReplyingTo({ msg, quoteText: text })} 
            />
          </main>

          <footer className="p-6 bg-[#0a0a0c]/95 border-t border-white/5 z-40">
            <div className="max-w-4xl mx-auto">
              {canPost ? (
                <InputArea onSend={handleSend} replyingTo={replyingTo} onCancelReply={() => setReplyingTo(null)} />
              ) : (
                <div className="py-4 px-8 bg-indigo-500/5 border border-indigo-500/10 rounded-[1.5rem] flex items-center justify-center gap-4">
                  <Activity size={18} className="text-indigo-500 animate-pulse" />
                  <p className="text-[10px] font-black uppercase text-slate-500 tracking-widest italic">Esperando inicio del docente...</p>
                </div>
              )}
            </div>
          </footer>
        </div>

        <Sidebar
          isOpen={isSidebarOpen}
          onClose={() => setIsSidebarOpen(false)}
          isAdmin={isAdmin}
          currentSessionId={session?.id}
          onSwitchSession={handleSwitchSession}
          onNewDebate={handleNewDebate}
          messages={messages}
          sendMessage={sendMessage}
          setIsAnalyticsOpen={setIsAnalyticsOpen}
        />

        <AnalyticsModal
          isOpen={isAnalyticsOpen}
          onClose={() => setIsAnalyticsOpen(false)}
          messages={messages}
        />
      </div>
    </AccessGuard>
  );
}

export default App;

================================================================================
ARCHIVO: .\src\components\AccessGuard.jsx
================================================================================
import React, { useState, useEffect } from 'react';
import { supabase } from '../lib/supabase';
import { generateTechCode, generateAlias } from '../utils/aliases';
import {
  PlusCircle, Hash, ChevronRight, Activity,
  Loader2, Zap, UserCheck
} from 'lucide-react';

const AccessGuard = ({ children, isAdmin, session, user, setSession, onUserAssigned, sessionReady }) => {
  // Estados para la navegaci√≥n interna del login
  const [view, setView] = useState(isAdmin ? 'choice' : 'student_join');
  const [tema, setTema] = useState('');
  const [codigoBusqueda, setCodigoBusqueda] = useState('');
  const [savedSessions, setSavedSessions] = useState([]);
  const [loading, setLoading] = useState(false);

  // Cargar historial solo para el administrador
  useEffect(() => {
    if (isAdmin) {
      supabase.from('sesiones').select('*').order('created_at', { ascending: false })
        .then(({ data }) => setSavedSessions(data || []));
    }
  }, [isAdmin]);

  // Funci√≥n para que el docente cree un nuevo debate
  const handleCreate = async (e) => {
    e.preventDefault();
    setLoading(true);
    const code = generateTechCode();

    const { data, error } = await supabase
      .from('sesiones')
      .insert([{
        tema: tema,
        codigo: code,
        status: 'waiting'
      }])
      .select()
      .single();

    if (error) {
      setLoading(false);
      alert("Error al crear sesi√≥n: " + error.message);
      return;
    }

    if (data) {
      setSession(data);
      onUserAssigned({ name: "Docente", color: "#818cf8", isAdmin: true });
    }
  };

  // Funci√≥n para que el estudiante se una mediante c√≥digo
  // Funci√≥n para que el estudiante se una mediante c√≥digo
  const handleJoin = async (e) => {
    e.preventDefault();
    setLoading(true);
    const code = codigoBusqueda.toUpperCase();

    const { data, error } = await supabase
      .from('sesiones')
      .select('*')
      .eq('codigo', code)
      .single();

    if (data) {
      // El estudiante entra a la sesi√≥n independientemente de si est√° activa o no
      const storageKey = `alicia_identity_${data.codigo}`;
      const saved = localStorage.getItem(storageKey);
      const identity = saved ? JSON.parse(saved) : generateAlias();

      if (!saved) localStorage.setItem(storageKey, JSON.stringify(identity));

      setSession(data); // <--- ESTO lo manda a la Sala de Espera si no est√° activa
      onUserAssigned(identity);
    } else {
      alert("C√≥digo no v√°lido");
    }
    setLoading(false);
  };

  // --- L√ìGICA DE RENDERIZADO (SALA DE ESPERA VS TABLERO) ---
  // --- SALA DE ESPERA (Se activa si el status no es 'active') ---
  if (sessionReady) {
    if (!isAdmin && session?.status !== 'active') {
      return (
        <div className="h-screen w-screen bg-[#0a0a0c] flex flex-col items-center justify-center p-6 text-center font-sans overflow-hidden relative">

          {/* BOT√ìN REGRESAR (En la esquina superior) */}
          <button
            onClick={() => { setSession(null); onUserAssigned(null); }}
            className="absolute top-10 left-10 p-3 bg-white/5 border border-white/10 rounded-2xl text-slate-500 hover:text-white hover:bg-white/10 transition-all flex items-center gap-2 text-[10px] font-black uppercase tracking-widest z-50"
          >
            <ChevronRight size={14} className="rotate-180" /> Regresar
          </button>

          <div className="relative mb-10">
            <div className="absolute -inset-10 bg-indigo-500/10 blur-[80px] rounded-full animate-pulse" />
            <div className="relative w-24 h-24 flex items-center justify-center">
              <Loader2 className="w-full h-full text-indigo-500 animate-spin opacity-20" />
              <Zap className="absolute text-indigo-400 animate-bounce" size={32} />
            </div>
          </div>

          <div className="space-y-2 z-10 animate-in fade-in zoom-in duration-700">
            <h2 className="text-xl font-black uppercase tracking-[0.3em] text-white italic">
              Sinapsis en Espera
            </h2>
            <div className="flex items-center justify-center gap-2 py-2 px-4 bg-white/5 border border-white/10 rounded-full mx-auto w-fit">
              <UserCheck size={12} className="text-indigo-400" />
              <p className="text-slate-400 text-[10px] font-black uppercase tracking-widest">
                ID: <span className="text-indigo-400 font-mono">{user?.name}</span>
              </p>
            </div>

            <div className="pt-8 max-w-xs mx-auto">
              <div className="h-[1px] w-full bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent mb-6" />
              <p className="text-slate-500 text-[10px] leading-relaxed uppercase tracking-tighter font-bold italic">
                "La red neuronal se est√° estabilizando. El docente iniciar√° la sesi√≥n en breve."
              </p>
            </div>
          </div>
        </div>
      );
    }

    return children; // Si est√° activa o eres admin, entras al tablero
  }

  // --- FORMULARIOS DE ACCESO (VISTA INICIAL) ---
  return (
    <div className="h-screen w-screen bg-[#060608] flex items-center justify-center p-6 font-sans">
      <div className="w-full max-w-md bg-[#0e0e12] border border-white/10 rounded-[2.5rem] p-10 shadow-2xl relative overflow-hidden">
        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-500" />

        <div className="text-center mb-10">
          <h2 className="text-2xl font-black text-white uppercase italic tracking-tighter">Insight Board</h2>
          <p className="text-indigo-400 text-[9px] font-black uppercase tracking-[0.3em] mt-2">Cognitive Interface v4.0</p>
        </div>

        {isAdmin && view === 'choice' && (
          <div className="space-y-4 animate-in fade-in duration-500 text-left">
            <button
              onClick={() => setView('create')}
              className="w-full p-6 bg-indigo-600 hover:bg-indigo-500 text-white rounded-3xl flex items-center justify-between font-bold transition-all shadow-lg group"
            >
              <span className="flex items-center gap-3"><PlusCircle size={20} /> Nuevo Debate</span>
              <ChevronRight size={18} className="group-hover:translate-x-1 transition-transform" />
            </button>

            <div className="py-4 flex items-center gap-4">
              <div className="h-px bg-white/5 flex-1" />
              <span className="text-[10px] font-black text-slate-600 uppercase">Historial</span>
              <div className="h-px bg-white/5 flex-1" />
            </div>

            <div className="space-y-2 max-h-56 overflow-y-auto custom-scrollbar pr-2">
              {savedSessions.map(s => (
                <button
                  key={s.id}
                  onClick={() => {
                    setSession(s);
                    onUserAssigned({ name: "Docente", color: "#818cf8", isAdmin: true });
                  }}
                  className="w-full p-4 bg-white/5 hover:bg-white/10 rounded-2xl border border-white/5 transition-all"
                >
                  <p className="text-xs font-bold text-slate-300 uppercase truncate">{s.tema}</p>
                  <p className="text-[9px] text-indigo-500 font-mono mt-1 uppercase">{s.codigo} ‚Äî {s.status}</p>
                </button>
              ))}
            </div>
          </div>
        )}

        {(!isAdmin || view === 'create') && (
          <form onSubmit={isAdmin ? handleCreate : handleJoin} className="space-y-4 animate-in slide-in-from-bottom-4 text-left">
            <div className="space-y-2">
              <label className="text-[10px] font-black text-slate-500 uppercase ml-2 tracking-widest">
                {isAdmin ? "Tema del debate" : "Hash de Conexi√≥n"}
              </label>
              <div className="relative">
                {isAdmin ? <Activity className="absolute left-5 top-5 text-indigo-500" size={20} /> : <Hash className="absolute left-5 top-5 text-indigo-500" size={20} />}
                <input
                  required
                  autoFocus
                  className="w-full bg-white/5 border border-white/10 rounded-2xl p-5 pl-14 text-sm text-white outline-none focus:ring-1 ring-indigo-500 uppercase font-bold"
                  value={isAdmin ? tema : codigoBusqueda}
                  onChange={e => isAdmin ? setTema(e.target.value) : setCodigoBusqueda(e.target.value)}
                />
              </div>
            </div>
            <button
              disabled={loading}
              type="submit"
              className="w-full py-5 bg-indigo-600 text-white rounded-2xl font-black uppercase text-xs tracking-[0.2em] shadow-lg hover:bg-indigo-500 transition-all flex justify-center items-center"
            >
              {loading ? <Loader2 className="animate-spin" size={18} /> : (isAdmin ? "Desplegar Tablero" : "Establecer V√≠nculo")}
            </button>
            {isAdmin && (
              <button
                type="button"
                onClick={() => setView('choice')}
                className="w-full text-[9px] text-slate-600 uppercase font-black hover:text-white transition-colors"
              >
                Volver al historial
              </button>
            )}
          </form>
        )}
      </div>
    </div>
  );
};

export default AccessGuard;

================================================================================
ARCHIVO: .\src\components\AdminTools.jsx
================================================================================
const AdminTools = ({ messages }) => {
  const handleSynthesize = async () => {
    console.log("Enviando mensajes a la IA para resumir...", messages);
    // Aqu√≠ conectar√°s con tu API de IA (GPT-4/Claude) para procesar el board
    alert("Procesando s√≠ntesis de la discusi√≥n...");
  };

  return (
    <div className="fixed bottom-24 right-6 flex flex-col gap-3">
      <button 
        onClick={handleSynthesize}
        className="bg-purple-600 hover:bg-purple-500 text-white p-4 rounded-full shadow-2xl flex items-center gap-2 font-bold transition-all transform hover:scale-105"
      >
        ‚ú® Sintetizar Debate (IA)
      </button>
    </div>
  );
};

================================================================================
ARCHIVO: .\src\components\AnalyticsModal.jsx
================================================================================
import React, { useState, useEffect } from 'react';
// Cambiamos 'User' por 'Users' (con S al final)
import { X, Brain, Target, Zap, Loader2, TrendingUp, TrendingDown, Users, FileDown } from 'lucide-react'; 
// CORRECCI√ìN 1: Importar getEngagementRanking
import { getSemanticClusters, getEngagementRanking } from '../services/aiService';
import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable';

const AnalyticsModal = ({ isOpen, onClose, messages = [] }) => {
  const [clusters, setClusters] = useState([]);
  const [ranking, setRanking] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (isOpen && messages.length >= 3) {
      const analyze = async () => {
        setLoading(true);
        try {
          // Ejecutamos ambas peticiones en paralelo
          const [clusterData, rankingData] = await Promise.all([
            getSemanticClusters(messages),
            getEngagementRanking(messages)
          ]);

          setClusters(clusterData);
          setRanking(rankingData);
        } catch (error) {
          console.error("Fallo en el motor anal√≠tico:", error);
        } finally {
          setLoading(false);
        }
      };
      analyze();
    }
  }, [isOpen, messages.length]);

  const handleDownloadPDF = () => {
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text("REPORTE: MONITOR SEM√ÅNTICO", 14, 20);
    doc.setFontSize(10);
    doc.text(`Generado el: ${new Date().toLocaleString()}`, 14, 30);

    const tableData = clusters.map(c => [
      c.topic.toUpperCase(),
      c.summary,
      c.count,
      c.sentiment
    ]);

    autoTable(doc, {
      startY: 40,
      head: [['TEMA', 'RESUMEN SEM√ÅNTICO', 'IDEAS', 'POSTURA']],
      body: tableData,
      headStyles: { fillColor: [79, 70, 229] },
    });

    doc.save(`Reporte_Sinapsis_${new Date().getTime()}.pdf`);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-[#0e0e11]/90 backdrop-blur-xl animate-in fade-in duration-300">
      <div className="w-full max-w-5xl bg-[#14141a] border border-white/10 rounded-[2.5rem] shadow-2xl flex flex-col overflow-hidden max-h-[90vh]">

        {/* HEADER */}
        <div className="p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-indigo-500/20 rounded-2xl border border-indigo-500/30">
              <Brain className="text-indigo-400" size={24} />
            </div>
            <div>
              <h2 className="text-xl font-black text-white uppercase tracking-tighter">Monitor Sem√°ntico</h2>
              <p className="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]">Mapa de Sinton√≠a Cognitiva</p>
            </div>
          </div>

          <div className="flex items-center gap-2">
            {clusters.length > 0 && !loading && (
              <button
                onClick={handleDownloadPDF}
                className="flex items-center gap-2 px-4 py-2 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 text-slate-300 transition-all text-[10px] font-black uppercase tracking-widest mr-2"
              >
                <FileDown size={14} />
                PDF
              </button>
            )}
            <button onClick={onClose} className="p-3 hover:bg-white/5 rounded-full text-slate-500 hover:text-white transition-all">
              <X size={24} />
            </button>
          </div>
        </div>

        {/* CUERPO DEL MODAL (√Årea con scroll) */}
        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar space-y-12">
          
          {/* 1. KPIs R√ÅPIDOS */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="p-6 bg-white/[0.02] border border-white/5 rounded-3xl">
              <p className="text-[9px] font-black text-slate-500 uppercase mb-1">Volumen de Ideas</p>
              <h4 className="text-3xl font-black text-white">{messages.length}</h4>
            </div>
            <div className="p-6 bg-indigo-500/5 border border-indigo-500/10 rounded-3xl">
              <p className="text-[9px] font-black text-indigo-400 uppercase mb-1">Provocaciones Activas</p>
              <h4 className="text-3xl font-black text-indigo-300">{messages.filter(m => m.is_ai).length}</h4>
            </div>
            <div className="p-6 bg-white/[0.02] border border-white/5 rounded-3xl">
              <p className="text-[9px] font-black text-slate-500 uppercase mb-1">Impacto de IA</p>
              <h4 className="text-3xl font-black text-white">High</h4>
            </div>
          </div>

          {/* 2. √ÅREA DE CLUSTERING TEM√ÅTICO */}
          <div className="space-y-4">
            <h3 className="text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] ml-2">Distribuci√≥n Sem√°ntica</h3>

            {loading ? (
              <div className="min-h-[300px] border-2 border-dashed border-indigo-500/20 rounded-[2rem] flex flex-col items-center justify-center text-center p-12 bg-indigo-500/5">
                <Loader2 size={40} className="text-indigo-400 animate-spin mb-4" />
                <h3 className="text-sm font-black text-indigo-300 uppercase animate-pulse">DeepSeek est√° extrayendo los temas...</h3>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {clusters.map((cluster, idx) => (
                  <div key={idx} className="p-6 bg-white/[0.02] border border-white/10 rounded-3xl hover:bg-white/[0.04] transition-all group">
                    <div className="flex justify-between items-start mb-4">
                      <div className="px-3 py-1 bg-indigo-500/10 border border-indigo-500/20 rounded-full">
                        <span className="text-[10px] font-black text-indigo-400 uppercase">{cluster.topic}</span>
                      </div>
                      <div className={`flex items-center gap-2 text-[10px] font-black uppercase ${cluster.sentiment === 'Divergencia' ? 'text-rose-400' : 'text-emerald-400'}`}>
                        {cluster.sentiment === 'Divergencia' ? <TrendingDown size={14} /> : <TrendingUp size={14} />}
                        {cluster.sentiment}
                      </div>
                    </div>
                    <p className="text-xs text-slate-300 leading-relaxed mb-4 italic">"{cluster.summary}"</p>
                    <div className="flex items-center gap-2">
                      <Users size={12} className="text-slate-500" />
                      <span className="text-[10px] font-bold text-slate-500 uppercase">{cluster.count} Intervenciones</span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* CORRECCI√ìN 2: SECCI√ìN DE GAMIFICACI√ìN MOVIDA DENTRO DEL SCROLL */}
          <div className="space-y-6 pb-8">
            <div className="flex items-center gap-2 ml-2">
              <Zap size={14} className="text-amber-400" fill="currentColor" />
              <h3 className="text-[10px] font-black uppercase text-slate-500 tracking-[0.2em]">
                Mentes Destacadas del Debate
              </h3>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              {ranking.length > 0 ? (
                ranking.map((player, idx) => (
                  <div key={idx} className="p-6 bg-indigo-500/5 border border-indigo-500/10 rounded-[2rem] relative group hover:scale-[1.02] transition-all">
                    <div className="flex flex-col items-center text-center">
                      <div className="w-12 h-12 rounded-full bg-white/5 border border-white/10 flex items-center justify-center mb-3 text-lg font-black text-indigo-400">
                        {idx === 0 ? "ü•á" : idx === 1 ? "ü•à" : "ü•â"}
                      </div>
                      <span className="text-[11px] font-black text-white uppercase mb-1">{player.alias}</span>
                      <div className="px-3 py-0.5 bg-indigo-500/20 rounded-full mb-3">
                        <span className="text-[8px] font-black text-indigo-300 uppercase tracking-tighter">{player.badge}</span>
                      </div>
                      <p className="text-[10px] text-slate-500 italic leading-tight px-2">"{player.reason}"</p>
                    </div>
                  </div>
                ))
              ) : (
                !loading && <p className="col-span-3 text-center text-[10px] text-slate-600 uppercase font-bold tracking-widest py-8">A√∫n no hay suficiente actividad para el ranking...</p>
              )}
            </div>
          </div>

        </div> {/* CIERRE DEL CUERPO CON SCROLL */}
      </div>
    </div>
  );
};

export default AnalyticsModal;

================================================================================
ARCHIVO: .\src\components\Board.jsx
================================================================================
import React, { useCallback, useMemo, useEffect, useState } from 'react';
import ReactFlow, { 
  Background, 
  Controls, 
  useNodesState, 
  useEdgesState,
  MarkerType
} from 'reactflow';
import 'reactflow/dist/style.css'; 
import SynapseNode from './SynapseNode';
import { getLayoutedElements } from '../utils/layout';
import { supabase } from '../lib/supabase';

const nodeTypes = { synapse: SynapseNode };

const Board = ({ messages, isAdmin, userAlias, onReply }) => {
  const [isolatedId, setIsolatedId] = useState(null);

  // Funci√≥n para encontrar todos los descendientes de un nodo (hijos, nietos, etc.)
  const getDescendants = useCallback((parentId, allMessages, result = []) => {
    const children = allMessages.filter(m => m.parent_id === parentId);
    children.forEach(child => {
      result.push(child);
      getDescendants(child.id, allMessages, result);
    });
    return result;
  }, []);

  // 1. Procesamiento de Nodos y Edges
  const { initialNodes, initialEdges } = useMemo(() => {
    if (!messages || messages.length === 0) return { initialNodes: [], initialEdges: [] };

    // --- L√ìGICA DE AISLAMIENTO ---
    let visibleMessages = messages;
    if (isolatedId) {
      const rootNode = messages.find(m => m.id === isolatedId);
      const descendants = getDescendants(isolatedId, messages);
      visibleMessages = rootNode ? [rootNode, ...descendants] : messages;
    }

    // Creamos los nodos base usando los mensajes visibles
    let nodes = visibleMessages.map(msg => ({
      id: msg.id,
      type: 'synapse',
      data: { 
        msg, 
        isAdminView: isAdmin, 
        userAlias, 
        onReply, 
        isRoot: !msg.parent_id,
        onIsolate: () => setIsolatedId(msg.id) // Funci√≥n para activar el aislamiento
      },
      position: { x: msg.x_pos || 0, y: msg.y_pos || 0 }
    }));

    // Creamos las conexiones
    const seed = visibleMessages.find(m => !m.parent_id);

    const edges = visibleMessages
      .filter(msg => msg.id !== (isolatedId || seed?.id)) // No conectar el nodo ra√≠z del modo actual
      .map(msg => {
        // Si estamos aislados, el padre por defecto es el nodo aislado. Si no, la semilla.
        const defaultParent = isolatedId || seed?.id;
        const parentId = msg.parent_id || defaultParent; 
        
        return {
          id: `e-${parentId}-${msg.id}`,
          source: parentId,
          target: msg.id,
          animated: true,
          type: 'default',
          style: { 
            stroke: msg.color_theme || '#6366f1', 
            strokeWidth: 1.2, // L√≠neas m√°s delgadas y elegantes
            opacity: 0.8 
          },
          markerEnd: { 
            type: MarkerType.ArrowClosed, 
            color: msg.color_theme || '#6366f1',
            width: 15, height: 15 
          },
        };
      });

    // Calculamos el layout autom√°tico
    const layouted = getLayoutedElements(nodes, edges, 'LR');
    
    // PRIORIDAD: Si el mensaje ya tiene posici√≥n manual en la DB, la respetamos
    const finalNodes = layouted.nodes.map(node => {
      const msg = visibleMessages.find(m => m.id === node.id);
      if (msg && msg.x_pos !== null && msg.x_pos !== undefined) {
        return { 
          ...node, 
          position: { x: msg.x_pos, y: msg.y_pos } 
        };
      }
      return node;
    });

    return { initialNodes: finalNodes, initialEdges: layouted.edges };
  }, [messages, isAdmin, userAlias, onReply, isolatedId, getDescendants]);

  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);
  const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);

  useEffect(() => {
    setNodes(initialNodes);
    setEdges(initialEdges);
  }, [initialNodes, initialEdges, setNodes, setEdges]);

  // 2. Funci√≥n para persistir el movimiento del Administrador
  const onNodeDragStop = useCallback(async (event, node) => {
    if (!isAdmin) return;
    const { id, position } = node;
    
    const { error } = await supabase
      .from('intervenciones')
      .update({ 
        x_pos: Math.round(position.x), 
        y_pos: Math.round(position.y) 
      })
      .eq('id', id);

    if (error) console.error("Error al sincronizar posici√≥n:", error);
  }, [isAdmin]);

  return (
    <div className="w-full h-full bg-[#0a0a0c] relative">
      {/* BOT√ìN DE REGRESO A GLOBAL */}
      {isolatedId && (
        <button 
          onClick={() => setIsolatedId(null)}
          className="absolute top-6 left-1/2 -translate-x-1/2 z-50 px-6 py-2 bg-indigo-600/20 border border-indigo-500/50 text-indigo-400 text-[10px] font-black uppercase tracking-widest rounded-full hover:bg-indigo-500 hover:text-white transition-all backdrop-blur-md shadow-[0_0_20px_rgba(99,102,241,0.3)]"
        >
          ‚Üê Regresar a Conversaci√≥n Global
        </button>
      )}

      <ReactFlow
        nodes={nodes}
        edges={edges}
        onNodesChange={onNodesChange}
        onEdgesChange={onEdgesChange}
        onNodeDragStop={onNodeDragStop}
        nodeTypes={nodeTypes}
        fitView 
        fitViewOptions={{ padding: 0.2 }}
        minZoom={0.05}
        maxZoom={2}
        nodesDraggable={isAdmin}
      >
        <Background color="#1e1e24" gap={40} size={1} variant="dots" className="opacity-10" />
        <Controls className="!bg-indigo-950/80 !border-indigo-500/50 !fill-indigo-400 hover:!fill-white shadow-[0_0_15px_rgba(99,102,241,0.3)]" />
      </ReactFlow>
    </div>
  );
};

export default Board;

================================================================================
ARCHIVO: .\src\components\InputArea.jsx
================================================================================
import React, { useState } from 'react';
import { Send, X, Quote } from 'lucide-react';

const InputArea = ({ onSend, replyingTo, onCancelReply }) => {
  const [text, setText] = useState('');

  const handleSend = () => {
    if (!text.trim()) return;
    onSend(text);
    setText('');
  };

  return (
    <div className="flex flex-col gap-2">
      {replyingTo && (
        <div className="bg-indigo-500/10 border-l-2 border-indigo-500 p-3 rounded-r-lg flex justify-between items-start animate-in slide-in-from-bottom-2">
          <div className="flex flex-col gap-1">
            <span className="text-[9px] font-black text-indigo-400 uppercase tracking-widest flex items-center gap-1">
              <Quote size={10} /> Citando a {replyingTo.msg.alias}
            </span>
            <p className="text-xs text-slate-400 italic line-clamp-1">
              "{replyingTo.quoteText || replyingTo.msg.content}"
            </p>
          </div>
          <button onClick={onCancelReply} className="text-slate-500 hover:text-white p-1"><X size={14}/></button>
        </div>
      )}
      
      <div className="flex gap-3 items-center">
        <textarea
          className="flex-1 bg-white/5 border border-white/10 rounded-xl p-3 text-sm focus:ring-1 focus:ring-indigo-500 outline-none resize-none h-12 custom-scrollbar"
          placeholder="Escribe tu argumento..."
          value={text}
          onChange={(e) => setText(e.target.value)}
          onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSend())}
        />
        <button 
          onClick={handleSend}
          className="bg-indigo-600 hover:bg-indigo-500 p-3 rounded-xl transition-all active:scale-95 text-white"
        >
          <Send size={18} />
        </button>
      </div>
    </div>
  );
};

export default InputArea;

================================================================================
ARCHIVO: .\src\components\Leaderboard.jsx
================================================================================
import React, { useState } from 'react';
import { Trophy, ChevronDown, ChevronUp, Info, Star } from 'lucide-react';

const Leaderboard = ({ ranking }) => {
  const [expandedIdx, setExpandedIdx] = useState(null);

  // Si no hay nadie que haya superado el umbral de rigor, el cuadro no se muestra
  if (!ranking || ranking.length === 0) return null;

  return (
    <div className="mt-6 pt-6 border-t border-white/5 px-4 animate-in fade-in slide-in-from-bottom-4 duration-700">
      {/* T√çTULO DE SECCI√ìN */}
      <div className="flex items-center gap-2 mb-6">
        <div className="p-2 bg-amber-500/10 rounded-lg border border-amber-500/20 shadow-[0_0_15px_rgba(245,158,11,0.1)]">
          <Trophy className="text-amber-400" size={14} />
        </div>
        <div className="flex flex-col">
          <h3 className="text-[10px] font-black uppercase text-slate-400 tracking-[0.2em]">Cuadro de Honor</h3>
          <span className="text-[7px] font-bold text-slate-600 uppercase tracking-widest">Excelencia Acad√©mica</span>
        </div>
      </div>
      
      {/* LISTA DE MERITOCRACIA */}
      <div className="space-y-3">
        {ranking.map((player, idx) => {
          const isExpanded = expandedIdx === idx;
          const medals = ["ü•á", "ü•à", "ü•â"];

          return (
            <div 
              key={idx} 
              onClick={() => setExpandedIdx(isExpanded ? null : idx)}
              className={`group cursor-pointer overflow-hidden transition-all duration-500 border rounded-[1.5rem] 
                ${isExpanded 
                  ? 'bg-indigo-500/10 border-indigo-500/40 shadow-[0_0_20px_rgba(99,102,241,0.05)]' 
                  : 'bg-white/[0.02] border-white/5 hover:border-white/10 hover:bg-white/[0.04]'}`}
            >
              {/* CABECERA: ALIAS Y BADGE */}
              <div className="p-4 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <span className="text-xl filter drop-shadow-md group-hover:scale-110 transition-transform duration-300">
                    {medals[idx]}
                  </span>
                  <div className="flex flex-col min-w-0">
                    <span className="text-[10px] font-black text-white uppercase tracking-tighter truncate w-28">
                      {player.alias}
                    </span>
                    <div className="flex items-center gap-1">
                      <Star size={8} className="text-indigo-400 fill-indigo-400" />
                      <span className="text-[8px] font-bold text-indigo-400 uppercase tracking-widest">
                        {player.badge}
                      </span>
                    </div>
                  </div>
                </div>
                <div className={`transition-transform duration-300 ${isExpanded ? 'rotate-180' : ''}`}>
                  <ChevronDown size={14} className="text-slate-600 group-hover:text-slate-400" />
                </div>
              </div>

              {/* PANEL DE ARGUMENTACI√ìN (ACORDE√ìN) */}
              {isExpanded && (
                <div className="px-4 pb-5 space-y-4 animate-in fade-in slide-in-from-top-2 duration-500">
                  {/* DEFINICI√ìN DEL ROL */}
                  <div className="p-3 bg-[#0a0a0c]/50 rounded-2xl border border-white/5">
                    <p className="text-[8px] font-black text-slate-500 uppercase mb-1.5 flex items-center gap-1.5">
                      <Info size={10} className="text-indigo-500" /> Perfil {player.badge}
                    </p>
                    <p className="text-[10px] text-slate-400 leading-tight italic font-medium">
                      "{player.definition}"
                    </p>
                  </div>
                  
                  {/* RAZ√ìN DEL PUESTO */}
                  <div className="px-1">
                    <p className="text-[8px] font-black text-indigo-400/70 uppercase mb-2 tracking-widest">An√°lisis de M√©rito:</p>
                    <p className="text-[11px] text-slate-200 leading-relaxed font-medium">
                      {player.reason}
                    </p>
                  </div>
                </div>
              )}
            </div>
          );
        })}
      </div>

      {/* NOTA DE RIGOR AL PIE */}
      <p className="mt-6 text-center text-[7px] text-slate-600 font-bold uppercase tracking-[0.2em] px-4 leading-normal">
        Evaluaci√≥n basada en la Verdad Acad√©mica del Docente e Interacciones Reales
      </p>
    </div>
  );
};

export default Leaderboard;

================================================================================
ARCHIVO: .\src\components\Login.jsx
================================================================================
import { supabase } from '../lib/supabase';

const Login = () => {
  const handleLogin = () => {
    supabase.auth.signInWithOAuth({ provider: 'google' });
  };

  return (
    <div className="h-screen w-screen bg-[#060608] flex items-center justify-center p-6">
      <div className="max-w-md w-full bg-[#0e0e12] border border-white/10 rounded-[3rem] p-12 text-center shadow-2xl">
        <h2 className="text-2xl font-black text-white uppercase italic tracking-tighter mb-2">Bienvenido</h2>
        <p className="text-slate-500 text-[10px] font-bold uppercase tracking-[0.2em] mb-10">Ingresa para gestionar tu Red Sin√°ptica</p>
        
        <button 
          onClick={handleLogin}
          className="w-full py-4 bg-white text-black rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-slate-200 transition-all flex items-center justify-center gap-3"
        >
          <img src="https://www.google.com/favicon.ico" className="w-4 h-4" alt="Google" />
          Entrar con Google
        </button>
      </div>
    </div>
  );
};

================================================================================
ARCHIVO: .\src\components\MessageCard.jsx
================================================================================
import React from 'react';
import { motion } from 'framer-motion';
import { MessageSquareReply, Shield, Target, Lightbulb, HelpCircle, Star } from 'lucide-react';
import { useReactions } from '../hooks/useReactions';

const MessageCard = ({ msg, onReply, isAdminView, onFocus, isFocused, userAlias }) => {
  const { counts, userReactions, toggleReaction } = useReactions(msg.id, userAlias);
  
  const isDocente = msg.alias === "Docente" || msg.alias === "Administrador";
  const isOwnMessage = msg.alias === userAlias;

  // Configuraci√≥n de los "bombillitos"
  const buttonConfigs = [
    { type: 'aporte', icon: <Lightbulb size={12} />, activeClass: 'text-amber-400 bg-amber-500/20 border-amber-500/40 shadow-[0_0_10px_rgba(245,158,11,0.2)]' },
    { type: 'duda', icon: <HelpCircle size={12} />, activeClass: 'text-rose-400 bg-rose-500/20 border-rose-500/40 shadow-[0_0_10px_rgba(244,63,94,0.2)]' },
    { type: 'interesante', icon: <Star size={12} />, activeClass: 'text-indigo-400 bg-indigo-500/20 border-indigo-500/40 shadow-[0_0_10px_rgba(99,102,241,0.2)]' }
  ];

  return (
    <motion.div layout
      className={`relative p-5 border shadow-2xl transition-all group
        ${isDocente ? 'bg-indigo-600/10 border-indigo-500/30 rounded-tr-3xl rounded-bl-3xl' : 'bg-[#16161a] border-white/5 rounded-2xl'}
        ${isAdminView ? 'w-80' : 'w-full max-w-2xl'}`}
    >
      <div className="flex justify-between items-center mb-3">
        <div className="flex items-center gap-2">
          <div className="w-1.5 h-1.5 rounded-full" style={{ backgroundColor: msg.color_theme }} />
          <span className="text-[10px] font-black uppercase tracking-widest" style={{ color: msg.color_theme }}>
            {msg.alias} {isOwnMessage && <span className="text-slate-500 ml-1">(T√ö)</span>}
          </span>
        </div>
        {isDocente && <Shield size={10} className="text-indigo-400" />}
      </div>

      <p className={`text-slate-200 leading-relaxed font-medium ${isAdminView ? 'text-[11px] line-clamp-4' : 'text-sm'}`}>
        {msg.content}
      </p>

      {/* PANEL DE REACCIONES (PULSADORES) */}
      <div className="mt-4 flex gap-2 pt-3 border-t border-white/5">
        {buttonConfigs.map((btn) => {
          const isActive = userReactions.includes(btn.type);
          return (
            <button 
              key={btn.type}
              disabled={isOwnMessage}
              onClick={() => toggleReaction(btn.type)}
              className={`px-2.5 py-1.5 rounded-xl flex items-center gap-2 border transition-all duration-300
                ${isOwnMessage ? 'opacity-30 cursor-not-allowed border-transparent' : 'cursor-pointer'}
                ${isActive ? btn.activeClass : 'bg-white/5 border-transparent text-slate-500 hover:text-slate-300 hover:bg-white/10'}`}
            >
              <span className={isActive ? 'animate-pulse' : ''}>{btn.icon}</span>
              <span className="text-[10px] font-black font-mono">{counts[btn.type]}</span>
            </button>
          );
        })}
        
        <div className="flex-1" />
        
        <div className="flex items-center gap-2">
          {!isFocused && <button onClick={onFocus} className="p-1.5 rounded-lg bg-white/5 text-slate-400 hover:text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity"><Target size={14}/></button>}
          <button onClick={() => onReply(msg)} className="p-1.5 rounded-lg bg-indigo-600/10 text-indigo-400 hover:bg-indigo-600 hover:text-white transition-all opacity-0 group-hover:opacity-100 transition-opacity"><MessageSquareReply size={14} /></button>
        </div>
      </div>
    </motion.div>
  );
};

export default MessageCard;

================================================================================
ARCHIVO: .\src\components\ParticipantsList.jsx
================================================================================
import React from 'react';
import { Users, Activity, Eye } from 'lucide-react'; // A√±adimos Eye

const ParticipantsList = ({ participants = [] }) => {
  return (
    <div className="h-full flex flex-col p-6 font-sans">
      {/* HEADER EXISTENTE */}
      <div className="flex items-center justify-between mb-6 border-b border-white/5 pb-4">
        <div className="flex items-center gap-2 text-indigo-400">
          <Activity size={14} className="animate-pulse" />
          <span className="text-[10px] font-black uppercase tracking-widest">En Vivo</span>
        </div>
        <div className="flex items-center gap-2 px-2 py-0.5 bg-indigo-500/10 border border-indigo-500/20 rounded-md">
          <Users size={12} className="text-indigo-400" />
          <span className="text-xs font-mono font-black text-white">{participants.length}</span>
        </div>
      </div>

     

      {/* LISTA DE ESTUDIANTES (Tu l√≥gica original intacta) */}
      <h3 className="text-[9px] font-black uppercase text-slate-500 tracking-[0.2em] mb-3">
        Mentes Conectadas
      </h3>
      <div className="flex-1 overflow-y-auto space-y-4 custom-scrollbar pr-2">
        {participants.map((p) => (
          <div key={p.presence_ref || p.id || p.name} className="flex items-center gap-3 group animate-in fade-in slide-in-from-right-2">
            <div 
              className="w-1.5 h-1.5 rounded-full shadow-[0_0_8px_currentcolor]" 
              style={{ backgroundColor: p.color, color: p.color }} 
            />
            <span className="text-xs font-bold text-slate-400 group-hover:text-white transition-colors uppercase tracking-tight">
              {p.name}
            </span>
          </div>
        ))}
        
        {participants.length === 0 && (
          <p className="text-[10px] text-slate-600 italic text-center py-4">Esperando conexiones...</p>
        )}
      </div>
    </div>
  );
};

export default ParticipantsList;

================================================================================
ARCHIVO: .\src\components\ReactionBar.jsx
================================================================================
import React from 'react';
import { Lightbulb, HelpCircle, Star } from 'lucide-react';
import { useReactions } from '../hooks/useReactions';

const ReactionBar = ({ intervencionId, userAlias }) => {
  const { counts, addReaction } = useReactions(intervencionId);

  const reactions = [
    { type: 'aporte', icon: <Lightbulb size={12} />, label: '¬°Buen punto!', color: 'text-amber-400' },
    { type: 'duda', icon: <HelpCircle size={12} />, label: 'Tengo duda', color: 'text-rose-400' },
    { type: 'interesante', icon: <Star size={12} />, label: 'Interesante', color: 'text-indigo-400' },
  ];

  return (
    <div className="flex gap-2 mt-2">
      {reactions.map((r) => (
        <button
          key={r.type}
          onClick={() => addReaction(r.type, userAlias)}
          className={`flex items-center gap-1.5 px-2 py-1 rounded-md bg-white/5 border border-white/5 hover:bg-white/10 transition-all group`}
        >
          <span className={`${r.color} group-hover:scale-110 transition-transform`}>{r.icon}</span>
          <span className="text-[9px] font-bold text-slate-400 uppercase">{counts[r.type]}</span>
        </button>
      ))}
    </div>
  );
};

export default ReactionBar;

================================================================================
ARCHIVO: .\src\components\SessionManager.jsx
================================================================================
import React, { useEffect, useState } from 'react';
import { supabase } from '../lib/supabase';
import { FolderOpen, Trash2, Calendar, Play, X } from 'lucide-react';

const SessionManager = ({ onSelectSession, onClose }) => {
  const [sessions, setSessions] = useState([]);

  useEffect(() => {
    fetchSessions();
  }, []);

  const fetchSessions = async () => {
    const { data } = await supabase.from('sesiones').select('*').order('created_at', { ascending: false });
    setSessions(data || []);
  };

  const deleteSession = async (id) => {
    if (confirm("¬øSeguro que deseas eliminar esta sesi√≥n y todos sus comentarios?")) {
      await supabase.from('sesiones').delete().eq('id', id);
      fetchSessions();
    }
  };

  return (
    <div className="bg-slate-900 border border-white/10 rounded-2xl shadow-2xl w-96 overflow-hidden">
      <div className="p-4 border-b border-white/5 flex justify-between items-center bg-indigo-500/10">
        <h2 className="text-[10px] font-black uppercase tracking-widest text-indigo-400 flex items-center gap-2">
          <FolderOpen size={14} /> Sesiones Guardadas
        </h2>
        <button onClick={onClose} className="text-slate-500 hover:text-white"><X size={16}/></button>
      </div>
      <div className="p-2 space-y-1 max-h-80 overflow-y-auto custom-scrollbar">
        {sessions.map(s => (
          <div key={s.id} className="flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-all group border border-transparent hover:border-white/5">
            <div className="flex flex-col">
              <span className="text-xs font-bold text-white uppercase truncate max-w-[180px]">{s.tema}</span>
              <div className="flex items-center gap-2 text-[9px] text-slate-500 font-mono">
                <Calendar size={10} /> {new Date(s.created_at).toLocaleDateString()}
                <span className="text-indigo-500 font-bold">[{s.codigo}]</span>
              </div>
            </div>
            <div className="flex gap-1">
              <button onClick={() => onSelectSession(s)} className="p-2 text-indigo-400 hover:bg-indigo-500/20 rounded-lg" title="Abrir">
                <Play size={14} />
              </button>
              <button onClick={() => deleteSession(s.id)} className="p-2 text-rose-500 hover:bg-rose-500/20 rounded-lg" title="Eliminar">
                <Trash2 size={14} />
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default SessionManager;

================================================================================
ARCHIVO: .\src\components\Sidebar.jsx
================================================================================
import React, { useState, useEffect } from 'react';
import {
  X, History, Trash2, ExternalLink, RefreshCw,
  Database, ChevronDown, ChevronRight, MessageSquare, BarChart3,
  Zap, Loader2, Activity 
} from 'lucide-react';
import { supabase } from '../lib/supabase';
import { generateTargetedProvocations } from '../services/aiService';

const STUDENT_COLOR_PALETTE = [
  "#34d399", // Esmeralda
  "#38bdf8", // Azul Cielo
  "#fb7185", // Rosa Suave
  "#fbbf24", // √Åmbar
  "#a78bfa", // Violeta
  "#22d3ee", // Cian
  "#f472b6", // Fucsia
];

const Sidebar = ({ 
  isOpen, onClose, isAdmin, currentSessionId, 
  onSwitchSession, onNewDebate, 
  messages, sendMessage,
  setIsAnalyticsOpen 
}) => {
  
  const [sessions, setSessions] = useState([]);
  const [isHistoryOpen, setIsHistoryOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [isAiThinking, setIsAiThinking] = useState(false);

  // Recupera todas las sesiones del docente desde Supabase
  const fetchSessions = async () => {
    setLoading(true);
    const { data, error } = await supabase
      .from('sesiones')
      .select(`*, intervenciones (id)`)
      .order('created_at', { ascending: false });

    if (!error) setSessions(data);
    setLoading(false);
  };

  // Alterna el estado de la sinapsis entre activo e inactivo
  const handleToggleStatus = async (e, sessionId, currentStatus) => {
    e.stopPropagation();
    const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
    
    const { error } = await supabase
      .from('sesiones')
      .update({ status: newStatus })
      .eq('id', sessionId);

    if (!error) {
      fetchSessions(); 
    } else {
      console.error("Error al cambiar estado:", error.message);
    }
  };

  // Elimina una sesi√≥n permanentemente tras confirmaci√≥n
  const handleDeleteSession = async (e, sessionId) => {
    e.stopPropagation();
    if (!window.confirm("¬øEliminar sesi√≥n permanentemente?")) return;

    const { error } = await supabase
      .from('sesiones')
      .delete()
      .eq('id', sessionId);

    if (error) {
      alert("No se pudo borrar: " + error.message);
    } else {
      if (sessionId === currentSessionId) {
        onNewDebate();
      } else {
        fetchSessions();
      }
    }
  };

  // Invoca al agente de IA para generar dudas socr√°ticas en el debate
  const handleInvokeAI = async () => {
    if (!currentSessionId || isAiThinking) return;

    setIsAiThinking(true);
    try {
      const targets = await generateTargetedProvocations(messages);

      if (targets && targets.length > 0) {
        for (const item of targets) {
          const randomColor = STUDENT_COLOR_PALETTE[Math.floor(Math.random() * STUDENT_COLOR_PALETTE.length)];

          await sendMessage(
            item.provocation,
            item.alias,
            randomColor,
            item.targetId,
            currentSessionId,
            true
          );
        }
      }
    } catch (error) {
      console.error("Fallo en la invocaci√≥n de IA:", error);
    } finally {
      setIsAiThinking(false);
    }
  };

  useEffect(() => {
    if (isAdmin) fetchSessions();
  }, [isAdmin]);

  return (
    <div 
      className={`fixed top-[70px] bottom-0 right-0 w-80 bg-[#0e0e12]/95 backdrop-blur-2xl border-l border-white/10 z-50 shadow-2xl flex flex-col transition-transform duration-500 ease-in-out font-sans
        ${isOpen ? 'translate-x-0' : 'translate-x-full'}`}
    >
      {/* BOT√ìN INTERNO PARA OCULTAR */}
      <button
        onClick={onClose}
        className="absolute left-[-30px] top-1/2 -translate-y-1/2 bg-[#0e0e12]/95 p-1.5 rounded-l-xl border-l border-y border-white/10 text-slate-500 hover:text-white transition-all shadow-[-5px_0_15px_rgba(0,0,0,0.5)]"
      >
        <ChevronRight size={18} />
      </button>

      {/* HEADER */}
      <div className="p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]">
        <div className="flex flex-col">
          <h2 className="text-[10px] font-black uppercase tracking-[0.2em] text-indigo-400 flex items-center gap-2">
            <Database size={14} /> Panel de Control
          </h2>
          <span className="text-[7px] text-slate-500 font-bold uppercase mt-1 tracking-widest">
            Design Interactive Hub v1.2.0 <br />Desarrollado por Ing. Leonardo Valderrama
          </span>
        </div>
        <button onClick={onClose} className="p-2 hover:bg-white/5 rounded-xl text-slate-500 hover:text-white transition-all">
          <X size={20} />
        </button>
      </div>

      <div className="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar">

        {/* SECCI√ìN: HISTORIAL DE SESIONES */}
        {isAdmin && (
          <section className="border border-white/5 rounded-2xl overflow-hidden bg-white/[0.01]">
            <button
              onClick={() => setIsHistoryOpen(!isHistoryOpen)}
              className="w-full p-4 flex items-center justify-between hover:bg-white/[0.03] transition-all"
            >
              <div className="flex items-center gap-3">
                <History size={14} className={isHistoryOpen ? "text-indigo-400" : "text-slate-500"} />
                <span className="text-[10px] font-black uppercase tracking-widest text-slate-300">
                  Historial de Sesiones
                </span>
              </div>
              {isHistoryOpen ? <ChevronDown size={14} className="text-slate-500" /> : <ChevronRight size={14} className="text-slate-500" />}
            </button>

            {isHistoryOpen && (
              <div className="px-2 pb-4 space-y-2 animate-in fade-in zoom-in-95 duration-200">
                <div className="max-h-[300px] overflow-y-auto pr-1 custom-scrollbar space-y-2">
                  {sessions.length === 0 ? (
                    <p className="text-[9px] text-slate-600 text-center py-4 uppercase font-bold italic">No hay registros previos</p>
                  ) : (
                    sessions.map((s) => (
                      <div
                        key={s.id}
                        onClick={() => onSwitchSession(s)}
                        className={`group relative p-3 rounded-xl border transition-all cursor-pointer ${s.id === currentSessionId
                            ? 'bg-indigo-500/10 border-indigo-500/40'
                            : 'bg-white/[0.02] border-white/5 hover:border-white/10'
                          }`}
                      >
                        <div className="flex flex-col gap-1 pr-14">
                          <span className="text-[10px] font-bold text-slate-200 truncate uppercase">{s.tema || 'Sin tema'}</span>
                          <div className="flex items-center gap-2">
                            <span className="text-[8px] font-mono text-indigo-400 font-bold">{s.codigo}</span>
                            <span className={`text-[7px] px-1.5 rounded-full border ${s.status === 'active' ? 'border-emerald-500/30 text-emerald-500' : 'border-slate-500/30 text-slate-500'} uppercase font-black`}>
                              {s.status}
                            </span>
                          </div>
                        </div>

                        <div className="absolute right-2 top-1/2 -translate-y-1/2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                          <button
                            onClick={(e) => handleToggleStatus(e, s.id, s.status)}
                            className={`p-1.5 border rounded-lg transition-all ${s.status === 'active' ? 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20' : 'bg-white/5 text-slate-500 border-white/10'}`}
                            title={s.status === 'active' ? 'Inactivar Sinapsis' : 'Activar Sinapsis'}
                          >
                            <Activity size={10} className={s.status === 'active' ? 'animate-pulse' : ''} />
                          </button>
                          <button onClick={(e) => { e.stopPropagation(); onSwitchSession(s); }} className="p-1.5 bg-indigo-500/20 text-indigo-400 rounded-lg hover:bg-indigo-500 transition-all"><ExternalLink size={10} /></button>
                          <button onClick={(e) => handleDeleteSession(e, s.id)} className="p-1.5 bg-rose-500/10 text-rose-500 rounded-lg hover:bg-rose-500 transition-all"><Trash2 size={10} /></button>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}
          </section>
        )}

        {/* IA ESTRAT√âGICA */}
        {isAdmin && currentSessionId && (
          <section className="p-5 border border-indigo-500/20 rounded-2xl bg-indigo-500/5 space-y-4">
            <h3 className="text-[10px] font-black uppercase text-indigo-400 tracking-[0.2em] flex items-center gap-2">
              <Zap size={14} fill="currentColor" /> Comentario
            </h3>

            <button
              onClick={handleInvokeAI}
              disabled={isAiThinking}
              className={`w-full py-4 rounded-xl border transition-all flex items-center justify-center gap-3 font-black uppercase text-[10px] tracking-widest ${isAiThinking ? 'bg-indigo-500/10 border-indigo-500/20 text-indigo-400 cursor-wait' : 'bg-indigo-600/20 border-indigo-500/40 text-indigo-100 hover:bg-indigo-600 hover:text-white shadow-[0_0_20px_rgba(99,102,241,0.15)]'}`}
            >
              {isAiThinking ? <><Loader2 size={14} className="animate-spin" /> Analizando...</> : <>Lanzar Comentario</>}
            </button>
          </section>
        )}

        {/* ANAL√çTICA */}
        {isAdmin && currentSessionId && (
          <section className="mt-4 p-4 border border-white/5 rounded-2xl bg-white/[0.01]">
            <button
              onClick={() => setIsAnalyticsOpen(true)}
              className="w-full p-4 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 hover:border-white/20 transition-all flex flex-col items-center gap-2 group"
            >
              <BarChart3 size={20} className="text-indigo-400 group-hover:scale-110 transition-transform" />
              <span className="text-[10px] font-black uppercase tracking-widest text-slate-300">
                Abrir Monitor Sem√°ntico
              </span>
            </button>
          </section>
        )}
      </div>

      {/* FOOTER */}
      {isAdmin && (
        <div className="p-6 border-t border-white/5 bg-white/[0.01]">
          <button
            onClick={onNewDebate}
            className="w-full py-4 bg-indigo-600/10 hover:bg-indigo-600 hover:text-white text-indigo-400 rounded-2xl font-black text-[10px] uppercase tracking-widest flex items-center justify-center gap-2 border border-indigo-500/20 transition-all"
          >
            <RefreshCw size={14} /> Iniciar Nuevo Debate
          </button>
        </div>
      )}
    </div>
  );
};

export default Sidebar;

================================================================================
ARCHIVO: .\src\components\SynapseNode.jsx
================================================================================
import React, { memo } from 'react';
import { Handle, Position } from 'reactflow';
// Mantenemos Zap para el Docente
import { Shield, MessageSquareReply, Maximize2, Zap } from 'lucide-react';

const SynapseNode = memo(({ data }) => {
    const { msg, userAlias, onReply, isRoot, onIsolate } = data;

    const isAi = msg.is_ai;
    const isDocente = msg.alias === "Docente" || msg.alias === "Administrador" || msg.alias === "Admin";

    // Eliminamos el forzado de color para la IA para que use su color de "estudiante"
    const themeColor = msg.color_theme || '#6366f1';

    return (
        <div className="relative group transition-all duration-300">
            {/* Resplandor Ne√≥n: Normal para todos, ligeramente m√°s opaco para el Docente */}
            <div
                className={`absolute -inset-1 blur-xl transition-opacity rounded-full opacity-20 group-hover:opacity-50`}
                style={{ backgroundColor: themeColor }}
            />

            {/* Cuerpo del Orbe */}
            <div
                className={`relative min-w-[160px] max-w-[220px] p-3 rounded-[1.2rem] border backdrop-blur-md shadow-lg
                ${isRoot ? 'ring-1 ring-white/20' : ''} 
                ${isDocente ? 'ring-2 ring-indigo-500/50 border-indigo-400/50' : 'border-white/10'}`}
                style={{
                    backgroundColor: `${themeColor}15`,
                    borderColor: isDocente ? '#818cf8' : `${themeColor}44`,
                }}
            >
                {/* ETIQUETA DOCENTE: Ahora el Rayito lo lleva el profesor */}
                {isDocente && (
                    <div className="absolute -top-3 -left-1 bg-indigo-600 text-[7px] font-black px-2 py-0.5 rounded-full uppercase text-white flex items-center gap-1 shadow-lg border border-indigo-400 z-10">
                        <Zap size={8} fill="currentColor" />
                        {msg.alias}
                    </div>
                )}

                <div className="flex justify-between items-center mb-1.5">
                    <div className="flex items-center gap-1.5">
                        {/* Peque√±o pulso: √önica marca secreta que solo t√∫ (el docente) notar√°s en los hilos de IA */}
                        <div
                            className={`w-1.5 h-1.5 rounded-full shadow-[0_0_5px_currentColor] 
    ${isAi ? 'animate-[pulse_1.5s_ease-in-out_infinite]' : ''}`} // Latido exclusivo para la IA
                            style={{
                                color: themeColor,
                                backgroundColor: themeColor,
                                // Si es IA, podemos hacer que el brillo sea ligeramente m√°s intenso
                                filter: isAi ? 'brightness(2.5)' : 'none'
                            }}
                        />
                        <span className="text-[8px] font-black uppercase tracking-tight truncate max-w-[100px] text-white/60">
                            {msg.alias}
                        </span>
                    </div>
                    {/* El escudo solo aparece si es docente y no es una intervenci√≥n secreta */}
                    {isDocente && <Shield size={10} className="text-indigo-400" />}
                </div>

                {/* Texto: Eliminamos la cursiva de IA para que no sospechen */}
                <p className="text-[11px] leading-[1.3] font-medium mb-2 text-slate-100">
                    {msg.content.replace(/^> .*?\s/, "")}
                </p>

                <div className="flex items-center justify-between border-t border-white/5 pt-1.5">
                    <span className="text-[7px] font-mono text-slate-600 italic">
                        {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                    </span>

                    <div className="flex items-center gap-1">
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onIsolate();
                            }}
                            title="Aislar este debate"
                            className="p-1 rounded-full bg-white/5 hover:bg-indigo-500/20 text-slate-400 hover:text-indigo-400 transition-all border border-white/10"
                        >
                            <Maximize2 size={11} />
                        </button>

                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onReply(msg, msg.content);
                            }}
                            title="Responder"
                            className="p-1 rounded-full bg-white/5 hover:bg-white/10 text-white transition-all border border-white/10"
                        >
                            <MessageSquareReply size={12} />
                        </button>
                    </div>
                </div>
            </div>

            <Handle type="target" position={Position.Left} className="!opacity-0" style={{ left: '10px' }} />
            <Handle type="source" position={Position.Right} className="!opacity-0" />
        </div>
    );
});

export default SynapseNode;

================================================================================
ARCHIVO: .\src\components\TopStatusHub.jsx
================================================================================
import React, { useState } from 'react';
import { Users, ChevronDown, ChevronUp, Radio, Trophy } from 'lucide-react';
import Leaderboard from './Leaderboard';

const TopStatusHub = ({ connectedUsers = [], ranking = [], sessionStatus }) => {
  const [isExpanded, setIsExpanded] = useState(false);

  return (
    // CAMBIO: Alineado a la derecha (right-20) y ancho reducido (w-72)
    <div className="fixed top-[75px] right-20 z-40 w-72 transition-all duration-500 ease-in-out">
      {/* BARRA COMPACTA */}
      <div 
        onClick={() => setIsExpanded(!isExpanded)}
        className={`flex items-center justify-between px-4 py-2 bg-[#0e0e12]/90 backdrop-blur-xl border border-white/10 shadow-2xl cursor-pointer transition-all duration-300
          ${isExpanded ? 'rounded-t-2xl border-b-0' : 'rounded-xl hover:border-indigo-500/50'}`}
      >
        <div className="flex items-center gap-3">
          <div className={`w-1.5 h-1.5 rounded-full ${sessionStatus === 'active' ? 'bg-emerald-500 animate-pulse' : 'bg-slate-600'}`} />
          <span className="text-[9px] font-black uppercase tracking-widest text-slate-300">
            {connectedUsers.length} Mentes
          </span>
        </div>

        <div className="flex items-center gap-2">
          {ranking.length > 0 && !isExpanded && <Trophy size={12} className="text-amber-400" />}
          {isExpanded ? <ChevronUp size={14} className="text-slate-500" /> : <ChevronDown size={14} className="text-slate-500" />}
        </div>
      </div>

      {/* PANEL DESPLEGABLE VERTICAL */}
      <div 
        className={`overflow-hidden transition-all duration-500 ease-in-out bg-[#0e0e12]/95 backdrop-blur-2xl border-x border-b border-white/10 rounded-b-2xl shadow-2xl
          ${isExpanded ? 'max-h-[60vh] opacity-100 p-4' : 'max-h-0 opacity-0 p-0 border-none'}`}
      >
        <div className="space-y-6">
          {/* Usuarios Conectados */}
          <section>
            <p className="text-[7px] font-black text-slate-500 uppercase tracking-[0.2em] mb-3">Conexiones Activas</p>
            <div className="flex flex-wrap gap-1.5">
              {connectedUsers.map((user, idx) => (
                <div key={idx} className="flex items-center gap-1.5 px-2 py-1 bg-white/5 border border-white/5 rounded-lg">
                  <div className="w-1.5 h-1.5 rounded-full" style={{ backgroundColor: user.color }} />
                  <span className="text-[8px] font-bold text-slate-400 uppercase truncate max-w-[60px]">{user.name}</span>
                </div>
              ))}
            </div>
          </section>

          {/* Ranking */}
          <section className="pt-4 border-t border-white/5">
            <Leaderboard ranking={ranking} />
          </section>
        </div>
      </div>
    </div>
  );
};

export default TopStatusHub;

================================================================================
ARCHIVO: .\src\hooks\useMessages.js
================================================================================
import { useState, useCallback } from 'react';
import { supabase } from '../lib/supabase';

export const useMessages = () => {
  const [messages, setMessages] = useState([]);

  // 1. Carga inicial: Ahora traer√° 'is_ai' autom√°ticamente por el select('*')
  const fetchMessagesBySession = useCallback(async (sessionId) => {
    if (!sessionId) return;
    
    const { data, error } = await supabase
      .from('intervenciones')
      .select('*')
      .eq('session_id', sessionId)
      .order('created_at', { ascending: true });

    if (!error && data) {
      setMessages(data);
    }
  }, []);

  // 2. Suscripci√≥n en Tiempo Real: El payload incluir√° 'is_ai' en payload.new
  const subscribeToMessages = useCallback((sessionId) => {
    if (!sessionId) return;

    const channel = supabase
      .channel(`realtime_session_${sessionId}`)
      .on(
        'postgres_changes',
        { 
          event: '*', 
          schema: 'public', 
          table: 'intervenciones',
          filter: `session_id=eq.${sessionId}` 
        },
        (payload) => {
          if (payload.eventType === 'INSERT') {
            setMessages((prev) => [...prev, payload.new]);
          } 
          else if (payload.eventType === 'UPDATE') {
            setMessages((prev) => 
              prev.map((msg) => msg.id === payload.new.id ? payload.new : msg)
            );
          }
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, []);

  // 3. Funci√≥n para enviar mensajes: Agregamos is_ai: false por seguridad
  const sendMessage = async (content, alias, color, parentId, sessionId, isAi = false) => {
  if (!sessionId) return;

  const { error } = await supabase
    .from('intervenciones')
    .insert([{
      content,
      alias,
      color_theme: color,
      parent_id: parentId,
      session_id: sessionId,
      is_ai: isAi // Ahora acepta el valor que le pasemos
    }]);

  if (error) {
    console.error("‚ùå Fallo en la sinapsis:", error.message);
  }
};

  return { messages, sendMessage, fetchMessagesBySession, subscribeToMessages };
};

================================================================================
ARCHIVO: .\src\hooks\usePresence.js
================================================================================
import { useEffect, useState } from 'react';
import { supabase } from '../lib/supabase';

export const usePresence = (sessionId, user) => {
  const [onlineUsers, setOnlineUsers] = useState([]);

  useEffect(() => {
    if (!sessionId || !user) return;

    const channel = supabase.channel(`presence:${sessionId}`, {
      config: { presence: { key: user.name } }
    });

    channel
  .on('presence', { event: 'sync' }, () => {
    const newState = channel.presenceState();
    // Transformamos el objeto complejo en una lista simple de usuarios
    const users = Object.values(newState).flat();
    setOnlineUsers(users);
  })
  .on('presence', { event: 'join' }, ({ newPresences }) => {
    console.log('Alguien entr√≥:', newPresences);
  })
  .on('presence', { event: 'leave' }, ({ leftPresences }) => {
    console.log('Alguien se fue:', leftPresences);
  })
  .subscribe(async (status) => {
    if (status === 'SUBSCRIBED') {
      await channel.track({
        user_id: user.id,
        name: user.name,
        color: user.color,
        online_at: new Date().toISOString(),
      });
    }
  });

    return () => { channel.unsubscribe(); };
  }, [sessionId, user]);

  return onlineUsers;
};

================================================================================
ARCHIVO: .\src\hooks\useReactions.js
================================================================================
import { useState, useEffect, useCallback } from 'react';
import { supabase } from '../lib/supabase';

export const useReactions = (intervencionId, userAlias) => {
  const [counts, setCounts] = useState({ aporte: 0, duda: 0, interesante: 0 });
  const [userReactions, setUserReactions] = useState([]);

  const fetchReactions = useCallback(async () => {
    if (!intervencionId) return;
    const { data, error } = await supabase
      .from('reacciones')
      .select('tipo_reaccion, usuario_alias')
      .eq('intervencion_id', intervencionId);
    
    if (!error && data) {
      const newCounts = data.reduce((acc, curr) => {
        acc[curr.tipo_reaccion] = (acc[curr.tipo_reaccion] || 0) + 1;
        return acc;
      }, { aporte: 0, duda: 0, interesante: 0 });
      
      setCounts(newCounts);
      setUserReactions(data.filter(r => r.usuario_alias === userAlias).map(r => r.tipo_reaccion));
    }
  }, [intervencionId, userAlias]);

  useEffect(() => {
    fetchReactions();
    const channel = supabase.channel(`rx_global_${intervencionId}`)
      .on('postgres_changes', { event: '*', schema: 'public', table: 'reacciones' }, (payload) => {
        const mid = payload.new?.intervencion_id || payload.old?.intervencion_id;
        if (mid === intervencionId) fetchReactions();
      })
      .subscribe();
    return () => { supabase.removeChannel(channel); };
  }, [intervencionId, fetchReactions]);

  const toggleReaction = async (tipo) => {
    if (!userAlias || !intervencionId) return;
    const isRemoving = userReactions.includes(tipo);

    // Actualizaci√≥n optimista
    setUserReactions(prev => isRemoving ? prev.filter(r => r !== tipo) : [...prev, tipo]);
    setCounts(prev => ({
      ...prev,
      [tipo]: isRemoving ? Math.max(0, prev[tipo] - 1) : prev[tipo] + 1
    }));

    if (isRemoving) {
      await supabase.from('reacciones').delete().match({ 
        intervencion_id: intervencionId, 
        usuario_alias: userAlias, 
        tipo_reaccion: tipo 
      });
    } else {
      await supabase.from('reacciones').insert([{ 
        intervencion_id: intervencionId, 
        usuario_alias: userAlias, 
        tipo_reaccion: tipo 
      }]);
    }
  };

  return { counts, userReactions, toggleReaction };
};

================================================================================
ARCHIVO: .\src\hooks\useSessions.js
================================================================================
// src/hooks/useSessions.js
import { useState, useEffect } from 'react';
import { supabase } from '../lib/supabase';

export const useSessions = () => {
  const [sessions, setSessions] = useState([]);

  const fetchSessions = async () => {
    const { data, error } = await supabase
      .from('sesiones')
      .select('*')
      .order('created_at', { ascending: false });
    if (!error) setSessions(data);
  };

  const deleteSession = async (id) => {
    // Esto borrar√° la sesi√≥n. Si configuraste "Cascade" en la DB, 
    // tambi√©n borrar√° todas sus intervenciones autom√°ticamente.
    const { error } = await supabase.from('sesiones').delete().eq('id', id);
    if (!error) fetchSessions(); // Refrescamos la lista
  };

  useEffect(() => {
    fetchSessions();
  }, []);

  return { sessions, fetchSessions, deleteSession };
};

================================================================================
ARCHIVO: .\src\index.css
================================================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Esto asegura que el fondo siempre sea oscuro y use toda la pantalla */
html, body, #root {
  height: 100%;
  margin: 0;
  background-color: #0f172a; /* slate-900 */
  color: white;
}

/* El scroll personalizado que definimos antes */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #334155;
  border-radius: 10px;
}

================================================================================
ARCHIVO: .\src\lib\supabase.js
================================================================================
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

================================================================================
ARCHIVO: .\src\main.jsx
================================================================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css' // <--- ESTA L√çNEA ES VITAL

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

================================================================================
ARCHIVO: .\src\services\aiService.js
================================================================================
const DEEPSEEK_API_KEY = import.meta.env.VITE_DEEPSEEK_API_KEY;
const API_URL = "https://api.deepseek.com/v1/chat/completions";

const ALIAS_POOL = [
  "Mente_Critica", "Socrates_Digital", "Duda_Metodica", 
  "Observador_Z", "Navegante_X", "Analista_Anonimo",
  "Perspectiva_B", "Curiosidad_Pura", "Estratega_01"
];

// --- M√ìDULO 1.2.1: AGENTE INFILTRADO ---
export const generateTargetedProvocations = async (messages) => {
  const seed = messages.find(m => !m.parent_id);
  const sessionAlias = ALIAS_POOL[Math.floor(Math.random() * ALIAS_POOL.length)];

  const prompt = `
    Eres un estudiante en un debate. Tu rol es ser un "Infiltrado Provocador".
    PREGUNTA SEMILLA: "${seed?.content}"
    HISTORIAL: ${messages.map(m => `[ID: ${m.id}] ${m.alias}: ${m.content}`).join('\n')}
    TAREA: Identifica hasta 2 comentarios y cuestiona su l√≥gica de forma incisiva pero educada.
    JSON: { "provocations": [{"targetId": "id", "provocation": "pregunta corta", "alias": "${sessionAlias}"}] }
  `;

  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_API_KEY}` },
      body: JSON.stringify({
        model: "deepseek-chat",
        messages: [{ role: "system", content: "Responde solo en JSON." }, { role: "user", content: prompt }],
        response_format: { type: 'json_object' }
      })
    });
    const data = await response.json();
    return JSON.parse(data.choices[0].message.content).provocations || [];
  } catch (error) {
    console.error("Error en provocaci√≥n:", error);
    return [];
  }
};

// --- M√ìDULO 2.0: MONITOR SEM√ÅNTICO ---
export const getSemanticClusters = async (messages) => {
  if (messages.length < 3) return [];

  const prompt = `
    Analiza este debate y agrupa los mensajes en 3 o 4 categor√≠as tem√°ticas.
    MENSAJES: ${messages.map(m => `- ${m.content}`).join('\n')}
    JSON: { "clusters": [{"topic": "T√≠tulo", "summary": "Resumen", "count": 0, "sentiment": "Sinton√≠a|Divergencia"}] }
  `;

  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_API_KEY}` },
      body: JSON.stringify({
        model: "deepseek-chat",
        messages: [{ role: "system", content: "Analista de datos cualitativos." }, { role: "user", content: prompt }],
        response_format: { type: 'json_object' }
      })
    });
    const data = await response.json();
    return JSON.parse(data.choices[0].message.content).clusters || [];
  } catch (error) {
    console.error("Error en clustering:", error);
    return [];
  }
};

// --- M√ìDULO 3.0: GAMIFICACI√ìN ROBUSTA (ACTUALIZADO) ---
export const getEngagementRanking = async (messages) => {
  // 1. CONTEXTO TOTAL: Enviamos todo para que la IA entienda la jerarqu√≠a
  const fullContext = messages.map(m => ({
    role: m.alias?.toLowerCase() === 'docente' ? 'VERDAD_ACAD√âMICA' : (m.is_ai ? 'PROVOCADOR' : 'ESTUDIANTE'),
    alias: m.alias,
    content: m.content
  }));

  // 2. CANDIDATOS: Filtramos para que solo los estudiantes reales puedan ganar medallas
  const students = messages.filter(m => 
    !m.is_ai && 
    m.alias?.toLowerCase() !== 'docente' && 
    m.alias?.toLowerCase() !== 'profesor'
  );

  console.log(`üìä [ANALISTA] Estudiantes reales para evaluar: ${students.length}`);

  // Umbral de 5 mensajes de alumnos para asegurar que hay debate real
  if (students.length < 5) {
    console.warn("‚ö†Ô∏è [ANALISTA] Base insuficiente para ranking riguroso (min 5 alumnos).");
    return [];
  }

  const prompt = `
    Act√∫a como un Evaluador Acad√©mico Estricto. Tu tarea es generar el Top 3 (Cuadro de Honor).
    
    CONTEXTO DEL DEBATE:
    ${JSON.stringify(fullContext)}

    REGLAS DE ORO PARA EL RANKING:
    1. ANCLA DE VERDAD: Usa los mensajes marcados como 'VERDAD_ACAD√âMICA' (Docente) como la √∫nica fuente de verdad t√©cnica. 
    2. PENALIZACI√ìN TROLL: Si un estudiante dice algo t√©cnicamente incorrecto, absurdo o que parece una burla (ej: definir Arduino como un zapato o una empanada), QU√âDALO FUERA del ranking inmediatamente. No importa cu√°ntas veces haya participado.
    3. RIGOR: No est√°s obligado a llenar los 3 puestos. Si solo 1 estudiante hizo aportes serios, pon 'null' en los otros puestos. Solo premia la calidad, la profundidad y el respeto a la verdad acad√©mica establecida por el docente.
    4. ROLES:
       - DISRUPTOR: Cuestiona con l√≥gica superior.
       - CONECTOR: Sintetiza y une ideas del docente y compa√±eros de forma brillante.
       - ANALISTA: Aporta rigor t√©cnico y precisi√≥n.

    TAREA: Devuelve un Top 3. Si un puesto no tiene un candidato digno, usa null.
    JSON: { 
      "ranking": [
        { "alias": "Nombre", "badge": "Rol", "definition": "Qu√© significa este rol", "reason": "Argumento pedag√≥gico basado en su interacci√≥n" },
        null, 
        null
      ] 
    }
  `;

  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_API_KEY}` },
      body: JSON.stringify({
        model: "deepseek-chat",
        messages: [
          { role: "system", content: "Eres un decano universitario imparcial y extremadamente riguroso." }, 
          { role: "user", content: prompt }
        ],
        response_format: { type: 'json_object' }
      })
    });
    
    const data = await response.json();
    const rawRanking = JSON.parse(data.choices[0].message.content).ranking;
    
    // Filtramos los valores nulos para enviar solo los ganadores reales a la interfaz
    const finalRanking = rawRanking.filter(item => item !== null);
    console.log("üèÜ [ANALISTA] Cuadro de Honor validado:", finalRanking);
    return finalRanking;
    
  } catch (error) {
    console.error("‚ùå [ANALISTA] Error cr√≠tico en evaluaci√≥n:", error);
    return [];
  }
};

================================================================================
ARCHIVO: .\src\utils\aliases.js
================================================================================
const TECH_WORDS = [
  'CLOUD', 'NEURAL', 'CORE', 'DATA', 'LOGIC', 'CYBER', 'BIT', 'NODO', 'LINK', 'ALICIA',
  'SYNAPSE', 'QUBIT', 'CORTEX', 'AXON', 'TENSOR', 'MATRIX', 'NEXUS', 'PRIME', 'VECTOR', 'PROXY'
];

const ADJETIVOS = [
  'Digital', 'Virtual', 'Binario', 'Cu√°ntico', 'Sincr√≥nico', 'Neural', 'Cripto', 'At√≥mico', 
  'Latente', 'Sint√©tico', 'H√≠brido', 'Recursivo', 'As√≠ncrono', 'Heur√≠stico', 'L√≥gico', 'Vectorial',
  'Cibern√©tico', 'Algor√≠tmico', 'Procesado', 'Distribuido', 'Persistente', 'Din√°mico', 'Meta'
];

const SUJETOS = [
  'Hopper', 'Node', 'Byte', 'User', 'Core', 'Link', 'Pulse', 'Prime', 'Ghost', 'Matrix', 
  'Nexus', 'Trace', 'Spark', 'Shell', 'Grid', 'Flow', 'Array', 'Buffer', 'Cluster', 'Kernel',
  'Socket', 'Thread', 'Fiber', 'Logic', 'Mind'
];

// Genera el c√≥digo de la sesi√≥n (Ej: NEURAL-A8F2)
export const generateTechCode = () => {
  const word = TECH_WORDS[Math.floor(Math.random() * TECH_WORDS.length)];
  const code = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `${word}-${code}`;
};

// Genera un color Ne√≥n/Vibrante (Formato HSL para asegurar brillo)
const generateNeonColor = () => {
  const hue = Math.floor(Math.random() * 360);
  return `hsl(${hue}, 80%, 60%)`; // Alta saturaci√≥n y brillo medio-alto
};

/**
 * @param {Array} takenNames - Lista de nombres ya ocupados en la sesi√≥n actual
 */
export const generateAlias = (takenNames = []) => {
  let name = "";
  let attempts = 0;

  // Intentamos generar un nombre que no est√© en la lista de nombres ocupados
  do {
    const adj = ADJETIVOS[Math.floor(Math.random() * ADJETIVOS.length)];
    const suj = SUJETOS[Math.floor(Math.random() * SUJETOS.length)];
    name = `${adj} ${suj}`;
    attempts++;
  } while (takenNames.includes(name) && attempts < 50);

  // Si despu√©s de 50 intentos sigue habiendo choque (clase masiva), a√±adimos un ID
  if (attempts >= 50) {
    name += ` ${Math.random().toString(36).substring(2, 4).toUpperCase()}`;
  }

  return {
    name: name,
    color: generateNeonColor()
  };
};

================================================================================
ARCHIVO: .\src\utils\layout.js
================================================================================
import dagre from 'dagre';

export const getLayoutedElements = (nodes, edges, direction = 'LR') => {
  const dagreGraph = new dagre.graphlib.Graph();
  dagreGraph.setDefaultEdgeLabel(() => ({}));

  // AJUSTE DE CERCAN√çA:
  // ranksep: Bajamos de 150 a 80 (distancia horizontal entre padre e hijo)
  // nodesep: Bajamos de 70 a 40 (distancia vertical entre hermanos)
  dagreGraph.setGraph({ 
  rankdir: 'LR', // Fuerza el crecimiento de Izquierda a Derecha
  ranksep: 100,  // Distancia entre niveles (Semilla -> Hijos)
  nodesep: 50,   // Distancia entre comentarios del mismo nivel
  ranker: 'tight-tree' // Optimiza la forma de √°rbol
});

  nodes.forEach((node) => {
    // Definimos el tama√±o del "hitbox" del orbe para el c√°lculo
    dagreGraph.setNode(node.id, { width: 220, height: 120 });
  });

  edges.forEach((edge) => {
    dagreGraph.setEdge(edge.source, edge.target);
  });

  dagre.layout(dagreGraph);

  const layoutedNodes = nodes.map((node) => {
    const nodeWithPosition = dagreGraph.node(node.id);
    node.position = {
      x: nodeWithPosition.x - 110,
      y: nodeWithPosition.y - 60,
    };
    return node;
  });

  return { nodes: layoutedNodes, edges };
};

================================================================================
ARCHIVO: .\tailwind.config.js
================================================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

================================================================================
ARCHIVO: .\vite.config.js
================================================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})


